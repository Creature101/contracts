<!doctype html>
<html lang="en">
<head>
    <title>Code coverage report for contracts/UniversalRegistry.sol</title>
    <meta charset="utf-8" />
    <link rel="stylesheet" href="../prettify.css" />
    <link rel="stylesheet" href="../base.css" />
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <style type='text/css'>
        .coverage-summary .sorter {
            background-image: url(../sort-arrow-sprite.png);
        }
    </style>
</head>
<body>
<div class='wrapper'>
  <div class='pad1'>
    <h1>
      <a href="../index.html">all files</a> / <a href="index.html">contracts/</a> UniversalRegistry.sol
    </h1>
    <div class='clearfix'>
      <div class='fl pad1y space-right2'>
        <span class="strong">42.11% </span>
        <span class="quiet">Statements</span>
        <span class='fraction'>16/38</span>
      </div>
      <div class='fl pad1y space-right2'>
        <span class="strong">23.33% </span>
        <span class="quiet">Branches</span>
        <span class='fraction'>7/30</span>
      </div>
      <div class='fl pad1y space-right2'>
        <span class="strong">54.55% </span>
        <span class="quiet">Functions</span>
        <span class='fraction'>6/11</span>
      </div>
      <div class='fl pad1y space-right2'>
        <span class="strong">43.9% </span>
        <span class="quiet">Lines</span>
        <span class='fraction'>18/41</span>
      </div>
    </div>
  </div>
  <div class='status-line low'></div>
<pre><table class="coverage">
<tr><td class="line-count quiet">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
143
144
145
146
147
148
149
150
151
152
153
154
155
156
157
158
159
160
161
162
163</td><td class="line-coverage quiet"><span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">2×</span>
<span class="cline-any cline-yes">2×</span>
<span class="cline-any cline-yes">2×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">2×</span>
<span class="cline-any cline-yes">2×</span>
<span class="cline-any cline-yes">2×</span>
<span class="cline-any cline-yes">2×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">2×</span>
<span class="cline-any cline-yes">2×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">2×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">2×</span>
<span class="cline-any cline-yes">2×</span>
<span class="cline-any cline-yes">2×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">2×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">2×</span>
<span class="cline-any cline-yes">2×</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span></td><td class="text"><pre class="prettyprint lang-js">pragma solidity ^0.4.24;
&nbsp;
import "./strings.sol";
import "./regex/NameRegex.sol";
import "./regex/ProtocolRegex.sol";
import "./Owned.sol";
&nbsp;
contract UniversalRegistry is Owned, NameRegex, ProtocolRegex {
&nbsp;
    using strings for *;
&nbsp;
    // Logged when the owner of a domain assigns a new owner to a subdomain.
    event NewRegistrant(string name, string protocol, address owner);
&nbsp;
    // Logged when the TTL of a node changes
    event NewTTL(string name, string protocol, uint64 ttl);
&nbsp;
    // Logged when the owner of a domain transfers ownership to a new account.
    event Transfer(string name, string protocol, address owner);
&nbsp;
    // Logged when register protocol
    event RegisterProtocol(string indexed _protocol, address _registrant);
&nbsp;
    struct Record {
        address registrant;
        uint64 ttl;
    }
&nbsp;
    constructor() public {
    }
&nbsp;
    mapping (string =&gt; Record) records;
    mapping (string =&gt; address) protocolOwner;
    string[] _protocols;
&nbsp;
    modifier onlyProtocolOwner(string _protocol) {
        <span class="missing-if-branch" title="else path not taken" >E</span>require(_protocol.toSlice().len() &gt; 0, "Protocol length incorrect");
        <span class="missing-if-branch" title="else path not taken" >E</span>require(protocolOwner[_protocol] == msg.sender, "sender is not protocol owner");
        _;
    }
&nbsp;
<span class="fstat-no" title="function not covered" >    modifier onlyRegistrant(string _name, string _protocol</span>) {
        // TODO more check on protocol and name
<span class="cstat-no" title="statement not covered" >        require(_name.toSlice().len() &gt; 0, "Name length incorrect")</span>;
<span class="cstat-no" title="statement not covered" >        require(_protocol.toSlice().len() &gt; 0, "Protocol length incorrect")</span>;
<span class="cstat-no" title="statement not covered" >        require(NameRegex.nameMatches(_name), "Name mismatch")</span>;
<span class="cstat-no" title="statement not covered" >        require(ProtocolRegex.protocolMatches(_protocol), "Protocol mismatch")</span>;
<span class="cstat-no" title="statement not covered" >        string memory protocol = ".".toSlice().concat(_protocol.toSlice())</span>;
<span class="cstat-no" title="statement not covered" >        string memory bns = _name.toSlice().concat(protocol.toSlice())</span>;
<span class="cstat-no" title="statement not covered" >        require(records[bns].registrant == msg.sender, "sender is not registred registrant")</span>;
        _;
    }
&nbsp;
    /**
     * @dev Set subdomain registrant
     *
     * @param _sub Subdomain of BNS
     * @param _name Name of BNS
     * @param _protocol Protocol of BNS
     * @param _owner The owner of subdomain
     */
<span class="fstat-no" title="function not covered" >    function setSubdomainRegistrant(string _sub, string _name, string _protocol, address _owner) external onlyRegistrant(_name, _protocol</span>) {
<span class="cstat-no" title="statement not covered" >        require(_sub.toSlice().len() &gt; 0, "Sub length incorrect")</span>;
<span class="cstat-no" title="statement not covered" >        require(NameRegex.nameMatches(_sub), "Sub mismatch")</span>;
<span class="cstat-no" title="statement not covered" >        string memory protocol = ".".toSlice().concat(_protocol.toSlice())</span>;
<span class="cstat-no" title="statement not covered" >        string memory bns = _name.toSlice().concat(protocol.toSlice())</span>;
<span class="cstat-no" title="statement not covered" >        _setSubdomainRegistrant(_sub, bns, _owner)</span>;
    }
&nbsp;
    /**
     * @dev The internal function of setSubdomainRegistrant
     *
     * @param _sub Subdomain of BNS
     * @param _bns BNS
     * @param _owner The owner of subdomain
     */
<span class="fstat-no" title="function not covered" >    function _setSubdomainRegistrant(string _sub, string _bns, address _owner) interna</span>l {
<span class="cstat-no" title="statement not covered" >        string memory bns = ".".toSlice().concat(_bns.toSlice())</span>;
<span class="cstat-no" title="statement not covered" >        string memory sub = _sub.toSlice().concat(bns.toSlice())</span>;
<span class="cstat-no" title="statement not covered" >        records[sub].registrant = _owner</span>;
    }
&nbsp;
    /**
     * @dev Set registrant of BNS
     *
     * @param _name Name of BNS
     * @param _protocol Protocol of BNS
     * @param _registrant Registrant of BNS
     */
    function setRegistrant(string _name, string _protocol, address _registrant) external onlyProtocolOwner(_protocol) {
        <span class="missing-if-branch" title="else path not taken" >E</span>require(_name.toSlice().len() &gt; 0, "Name length incorrect");
        <span class="missing-if-branch" title="else path not taken" >E</span>require(_protocol.toSlice().len() &gt; 0, "Protocol length incorrect");
        string memory protocol = ".".toSlice().concat(_protocol.toSlice());
        string memory bns = _name.toSlice().concat(protocol.toSlice());
        //require(records[bns].registrant == address(0), "");
        emit NewRegistrant(_name, _protocol, _registrant);
        records[bns].registrant = _registrant;
    }
&nbsp;
    /**
     * @dev Set time to leave of BNS
     * 
     * @param _name Name of BNS
     * @param _protocol Protocol of BNS
     * @param _ttl Time to leave of BNS
     */
<span class="fstat-no" title="function not covered" >    function setTTL(string _name, string _protocol, uint64 _ttl) external onlyRegistrant(_name, _protocol</span>) {
<span class="cstat-no" title="statement not covered" >        require(_name.toSlice().len() &gt; 0, "Name length incorrect")</span>;
<span class="cstat-no" title="statement not covered" >        require(_protocol.toSlice().len() &gt; 0, "Protocol length incorrect")</span>;
<span class="cstat-no" title="statement not covered" >        string memory protocol = ".".toSlice().concat(_protocol.toSlice())</span>;
<span class="cstat-no" title="statement not covered" >        string memory bns = _name.toSlice().concat(protocol.toSlice())</span>;
<span class="cstat-no" title="statement not covered" >        emit NewTTL(_name, _protocol, _ttl);</span>
<span class="cstat-no" title="statement not covered" >        records[bns].ttl = _ttl</span>;
    }
&nbsp;
    /**
     * @dev Get the registrant of BNS
     * 
     * @param bns BNS
     */
    function registrant(string bns) external view returns (address) {
        return records[bns].registrant;
    }
&nbsp;
    /**
     * @dev Get the time to leave of BNS
     * 
     * @param bns BNS
     */
<span class="fstat-no" title="function not covered" >    function ttl(string bns) external view returns (uint64</span>) {
<span class="cstat-no" title="statement not covered" >        return records[bns].ttl;</span>
    }
&nbsp;
    /**
     * @dev Set the protocol owner
     * 
     * @param _protocol Protocol of BNS
     * @param _registrant Registrant of protocol
     */
    function registerProtocol(string _protocol, address _registrant) public onlyOwner {
        <span class="missing-if-branch" title="else path not taken" >E</span>require(_protocol.toSlice().len() &gt; 0, "Protocol length incorrect");
        _protocols.push(_protocol);
        protocolOwner[_protocol] = _registrant;
&nbsp;
        emit RegisterProtocol(_protocol, _registrant);
    }
&nbsp;
    /**
     * @dev Check the protocol is available
     * 
     * @param _protocol protocol
     */
    function isProtocolAvailable(string _protocol) public view returns (bool) {
        for(uint i = 0; i &lt; _protocols.length; i++) {
            if (keccak256(abi.encodePacked(_protocol)) == keccak256(abi.encodePacked(_protocols[i]))) {
                return true;
            }
        }
        return false;
    }
&nbsp;
}
&nbsp;</pre></td></tr>
</table></pre>
<div class='push'></div><!-- for sticky footer -->
</div><!-- /wrapper -->
<div class='footer quiet pad2 space-top1 center small'>
  Code coverage
  generated by <a href="http://istanbul-js.org/" target="_blank">istanbul</a> at Sat Feb 09 2019 11:54:02 GMT+0800 (CST)
</div>
</div>
<script src="../prettify.js"></script>
<script>
window.onload = function () {
        if (typeof prettyPrint === 'function') {
            prettyPrint();
        }
};
</script>
<script src="../sorter.js"></script>
</body>
</html>
